<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>WebGIS PSU Jalan Kabupaten Ngawi</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<link rel="stylesheet" href="style.css">
</head>

<body>

<div class="header">
    <h1>WebGIS PSU Jalan</h1>
    <p>Kabupaten Ngawi</p>
    <span>Dibuat oleh: Erwin Ermaningsih | Tugas Latsar CPNS</span>
</div>

<div id="map"></div>

<!-- INFO PANEL -->
<div id="info-panel" class="info-panel hidden">
    <div class="info-header">
        <span>Detail Jalan</span>
        <button id="close-info">✕</button>
    </div>
    <div id="info-content"></div>
</div>

<!-- LEGEND -->
<div class="legend">
    <span>Jalan</span>
    <span class="legend-line"></span>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>

// Map dengan batas zoom
var map = L.map('map', {
    minZoom: 11,
    maxZoom: 19
}).setView([-7.4, 111.4], 12);

// Basemap Satelit
L.tileLayer(
'https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}',
{ attribution: 'Tiles © Esri' }
).addTo(map);

// Style jalan
function style(feature) {
    return {
        color: "#06b6d4",
        weight: window.innerWidth < 768 ? 9 : 6,
        opacity: 1
    };
}

function onEachFeature(feature, layer) {

    var nama = feature.properties.Nama ||
               feature.properties.nama ||
               feature.properties.NAMA ||
               "";

    // Pasang label tengah jalan
    layer.bindTooltip(nama, {
        permanent: true,
        direction: "center",
        className: "label-jalan"
    });

    layer.on('click', function () {

        // Hilangkan label saat diklik
        layer.unbindTooltip();

        var content = "<b style='color:#0f766e;'>Detail Jalan</b><br><br>";

        for (var key in feature.properties) {
            content += "<b>" + key + "</b>: " + feature.properties[key] + "<br>";
        }

        document.getElementById("info-content").innerHTML = content;
        document.getElementById("info-panel").classList.remove("hidden");

        window.activeLayer = layer;
        window.activeTooltipName = nama;
    });
}

// Load GeoJSON
fetch("Jalan.geojson")
.then(response => response.json())
.then(data => {

    // Outline agar kontras
    L.geoJSON(data, {
        style: {
            color: "#000",
            weight: window.innerWidth < 768 ? 12 : 8,
            opacity: 0.35
        }
    }).addTo(map);

    var geojsonLayer = L.geoJSON(data, {
        style: style,
        onEachFeature: onEachFeature
    }).addTo(map);

    map.fitBounds(geojsonLayer.getBounds());
    map.setMaxBounds(geojsonLayer.getBounds());
});

// Tombol X
document.getElementById("close-info").onclick = function(){

    document.getElementById("info-panel").classList.add("hidden");

    if (window.activeLayer && window.activeTooltipName) {
        window.activeLayer.bindTooltip(window.activeTooltipName, {
            permanent: true,
            direction: "center",
            className: "label-jalan"
        });
    }
};

// Fix resize mobile
window.addEventListener("resize", function(){
    setTimeout(function(){ map.invalidateSize(); },200);
});

</script>

</body>
</html>
