<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>WebGIS PSU Jalan Kabupaten Ngawi</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<link rel="stylesheet" href="style.css">
</head>

<body>

<div class="header">
    <h1>WebGIS PSU Jalan</h1>
    <p>Kabupaten Ngawi</p>
    <span>Erwin Ermaningsih | Latsar CPNS</span>
</div>

<div id="map"></div>

<div id="info-panel" class="info-panel hidden">
    <div class="info-header">
        <span>Detail Jalan</span>
        <button id="close-info">âœ•</button>
    </div>
    <div id="info-content"></div>
</div>

<div class="legend">
    <span>Jalan</span>
    <span class="legend-line"></span>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>

// INISIALISASI MAP
var map = L.map('map', {
    minZoom: 11,
    maxZoom: 19,
    maxBoundsViscosity: 0.6
}).setView([-7.4, 111.4], 12);

// BASEMAP OSM
L.tileLayer(
'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
{
    attribution: '&copy; OpenStreetMap contributors',
    maxZoom: 19
}).addTo(map);

// STYLE JALAN MERAH
function style(feature) {
    return {
        color: "#e10600",
        weight: window.innerWidth < 768 ? 9 : 6
    };
}

// INTERAKSI
function onEachFeature(feature, layer) {

    var nama = feature.properties.Nama ||
               feature.properties.nama ||
               feature.properties.NAMA || "";

    layer.bindTooltip(nama, {
        permanent: true,
        direction: "center",
        className: "label-jalan"
    });

    layer.on('click', function () {

        layer.unbindTooltip();

        var props = feature.properties;
        var isi = "<b>Detail Jalan</b><br><br>";

        for (var key in props) {

            if (key.toLowerCase() === "name" || key.toLowerCase() === "nama") {
                isi += "<b>Nama Jalan</b>: " + props[key] + "<br>";
            }

            else if (key.toLowerCase().includes("panjang")) {
                isi += "<b>" + key + "</b>: " + props[key] + " meter<br>";
            }

            else {
                isi += "<b>" + key + "</b>: " + props[key] + "<br>";
            }
        }

        document.getElementById("info-content").innerHTML = isi;
        document.getElementById("info-panel").classList.remove("hidden");

        window.activeLayer = layer;
        window.activeTooltipName = nama;
    });
}

// LOAD GEOJSON
fetch("Jalan.geojson")
.then(res => res.json())
.then(data => {

    L.geoJSON(data, {
        style: { color:"#000", weight:8, opacity:0.3 }
    }).addTo(map);

    var geojsonLayer = L.geoJSON(data, {
        style: style,
        onEachFeature: onEachFeature
    }).addTo(map);

    var bounds = geojsonLayer.getBounds();

    map.fitBounds(bounds, { padding:[20,20] });

    map.setMaxBounds(bounds.pad(0.5));
});

// TOMBOL CLOSE PANEL
document.getElementById("close-info").onclick = function(){

    document.getElementById("info-panel").classList.add("hidden");

    if (window.activeLayer && window.activeTooltipName) {
        window.activeLayer.bindTooltip(window.activeTooltipName, {
            permanent:true,
            direction:"center",
            className:"label-jalan"
        });
    }
};

// FIX RESIZE
window.addEventListener("resize", function(){
    setTimeout(() => map.invalidateSize(), 200);
});

</script>

</body>
</html>
